<!DOCTYPE HTML>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Cache-control" content="no-cache">
  <title>ClipAway</title>

  <link rel="stylesheet" type="text/css" href="css/third_party/w2ui-1.4.3.css"></link>
  <link rel="stylesheet" type="text/css" href="css/index.css">

  <script src="js/third_party/jquery/jquery-1.12.1.min.js"></script>
  <script src="js/third_party/katspaugh-wavesurfer.js-fdd4b7f/wavesurfer.min.js"></script>
  <script src="js/third_party/katspaugh-wavesurfer.js-fdd4b7f/wavesurfer.regions.min.js"></script>
  <script src="js/third_party/nayuki-obj/fft.js"></script>
  <script src="js/third_party/plotly/plotly-latest.min.js"></script>
  <script src="js/third_party/w2ui/w2ui-1.4.3.min.js"></script>

  <script src="js/AudioController.js"></script>
  <script src="js/ClipIntervalUtilities.js"></script>
  <script src="js/CubicSplineInterpolation.js"></script>
  <script src="js/DetectClipping.js"></script>
  <script src="js/FFTWrapper.js"></script>
  <script src="js/IndexGlobal.js"></script>
  <script src="js/Processing/AudioProcessingWorker.js"></script>
  <script src="js/Processing/Blocking.js"></script>
  <script src="js/Processing/ClippingDetectionWorker.js"></script>
  <script src="js/Processing/Declip.js"></script>
  <script src="js/Processing/DeclipShortBurstsWorker.js"></script>
  <script src="js/SignalProcessing.js"></script>
  <script src="js/Test.js"></script>
  <script src="js/WaveformInteractor.js"></script>
  <script src="js/WavEncoder.js"></script>
  <script src="js/WebAudioUtils.js"></script>
</head>

<body>
  <h1><center><img src="resources/logo_2.png"></img></center></h1>
  <div id="intro_text">
    <p>ClipAway allows you to declip audio. Clipping is a recording artifact
       which occurs when a microphone is recording at a higher sound level. The correct amplitude cannot correctly be represented, and
       instead the recorded amplitude is reduced to a value very near the maximum
       allowed value. The effect produced sounds a lot like distortion, although 
       in this case, it is not pleasant or wanted. One example of a recording 
       scenario where clipping is likely is when recording live concerts through
       mobile phones. </p>
    <p>Click below to chose a file to upload to the website. The file
       will be declipped, and an improved version will be downloaded to your
       computer.</p>
  </div>

  <div class="small_padding"></div>

  <div id="waveform_view">
    <div id="original_waveform_container">
      <div width="100%">
      <input id="audio_file_chooser" class="my_input" type="file" accept="audio/*"> </input>
      <div class="waveform_title">Input</div>   
      <div class="small_padding"></div>
      <div id="original_audio_waveform" class="wavesurfer"></div>
    </div><div class="small_padding"></div>

    <div id="processed_waveform_container">
      <div class="waveform_title">Output</div>
      <div class="small_padding"></div>
      <div id="processed_audio_waveform" class="wavesurfer"></div>
    </div><div class="small_padding"></div><div class="small_padding"></div>

    <div id="transport_container">
      <div id="transport_zoom_container">
        <img id="zoom_in_button" class="zoom_image" type="image" src="resources/transport/plus.png"></input>
        <img id="zoom_out_button" class="zoom_image" type="image" src="resources/transport/minus.png"></input>
      </div>

      <div id="transport_processing_container">
        <button id="detect_clipping_button" class="processing_button" onclick="DoDetectClipping();">Detect Clipping</button>
        <button id="declip_short_bursts_button" class="processing_button" onclick="DoDeclipShortBursts();">Declip Short Bursts</button>
        <button id="download_audio_button" class="processing_button" onclick="DownloadProcessedAudio()">Save Output</div>
      </div>

      <div id="transport_buttons_container">
        <img id="toggle_waveform_button" class="transport_image" type="image" src="resources/transport/toggle_original.png"></input>
        <img id="play_pause_button" class="transport_image" type="image" src="resources/transport/play.png"></input>
        <img id="play_selection_button" class="transport_image" type="image" src="resources/transport/play_selection.png"></input>
      </div>
    </div>
  </div>

  <div id="audio_processing_progress_popup" style="display: none; width: 650px; height: 110px; overflow: auto">
      <div rel="title">
          Processing Audio
      </div>
      <div rel="body">
        <div style="padding: 10; font-size: 11px; line-height: 150%;">
          Progress: 
          <div id="progress_bar" style="position: relative; width: 100%; height: 20px; background-color: grey;">
            <div id="progress_bar_progress" style="position: absolute; width: 1%; height: 100%; background-color: green"></div>
          </div>
        </div>
      </div>
  </div>

  <div id="plot_div" width=100px height=100px></div>
  <a id="download_processed_audio" style="display:none;"></a>
  <iframe id="my_iframe" style="display:none;">
  <script>
  function Download(url) {
      document.getElementById('my_iframe').src = url;
  };
  </script>
</body>

</html>